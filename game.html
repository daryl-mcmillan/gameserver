<html>
<script>

const baseUrl = "http://localhost:8080";

async function sleep(ms) {
	return new Promise( resolve => setTimeout( resolve, ms ) );
}

function generateName() {
	const chars = "abcdefghijklmnopqrstuvwxyz";
	const name = "************".replace(/./g, () => {
		return chars[ Math.floor( Math.random() * chars.length ) ];
	} );
	return name;
}

async function newGame() {
	for( ;; ) {
		const name = generateName();
		const response = await fetch( baseUrl + '/' + name, { method: 'PUT', body: '{}' });
		if( response.ok ) {
			const game = await response.json();
			console.log( "created new game", game );
			return game;
		}
	}
}

async function run() {
	var game = await newGame();
	for( ;; ) {
		const response = await fetch( baseUrl + game.waitForChangeUrl );
		if( !response.ok ) {
			const err = await response.json();
			console.log( "got error", err );
			await sleep( 5000 );
			continue;
		}
		game = await response.json();
		console.log( "new game state", game );
	}
}

run();

</script>
</html>